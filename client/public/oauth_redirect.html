<!DOCTYPE html>
<html>
<head>
    <title>Authentication Redirect</title>
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin-allow-popups">
</head>
<body>
    <script>
        // Parse the URL parameters that were passed by the backend
        const params = new URLSearchParams(window.location.search);
        const type = params.get('type');
        const error = params.get('error');
        const authorized = params.get('authorized');
        const details = params.get('details');

        console.log('OAuth redirect received:', { type, error, authorized, details });

        // Send the result back to the parent window
        if (window.opener) {
            if (type === 'oauth_success' && authorized === 'true') {
                window.opener.postMessage({ 
                    type: 'oauth_success', 
                    data: { authorized: true } 
                }, window.location.origin);
            } else if (type === 'oauth_error' || error) {
                window.opener.postMessage({ 
                    type: 'oauth_error', 
                    error: error || 'Authentication failed',
                    details: details 
                }, window.location.origin);
            } else {
                // Fallback for unexpected scenarios
                window.opener.postMessage({ 
                    type: 'oauth_error', 
                    error: 'Unexpected response format' 
                }, window.location.origin);
            }
        }

        // Close the popup window
        window.close();
    </script>
</body>
</html>